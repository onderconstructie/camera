<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Camera — Real-time Objectherkenning</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>
    
    <style>
        :root {
            --slate-50: #f8fafc;
            --slate-100: #f1f5f9;
            --slate-200: #e2e8f0;
            --slate-400: #94a3b8;
            --slate-500: #64748b;
            --slate-700: #334155;
            --slate-800: #1e293b;
            --white: #ffffff;
            --accent: #10b981;
            --green-50: #f0fdf4;
            --radius-lg: 16px;
            --radius-md: 12px;
            --radius-sm: 8px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--slate-50);
            color: var(--slate-700);
            margin: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
        }

        /* Header */
        .header {
            background: var(--white);
            border-bottom: 1px solid var(--slate-200);
            padding: 1.5rem;
            position: relative; /* Nodig voor de terug-link */
        }

        .header-content {
            max-width: 1100px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
        }

        /* De Terug-link (Stijl zoals andere pagina) */
        .back-link {
            position: absolute;
            left: 1.5rem;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            align-items: center;
            gap: 8px; 
            text-decoration: none;
            color: var(--slate-500); 
            font-weight: 500; 
            font-size: 1rem;
            transition: color 0.2s ease;
            z-index: 10;
        }
        .back-link:hover { color: var(--accent); }
        .back-link svg { width: 20px; height: 20px; stroke-width: 2; }

        @media (max-width: 600px) {
            .back-link span { display: none; } 
            .back-link { left: 1rem; }
            .header { padding: 1rem; }
        }

        .logo-circle {
            width: 42px;
            height: 42px;
            background: var(--green-50);
            border: 2px solid var(--accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .logo-circle svg {
            width: 24px;
            height: 24px;
            stroke: var(--accent);
            fill: none;
            stroke-width: 2;
        }

        h1 { font-size: 1.5rem; font-weight: 800; color: var(--slate-800); margin: 0; line-height: 1; }
        .subtitle { font-size: 0.875rem; color: var(--slate-500); margin-top: 4px; font-weight: 500; }

        /* Main Content Grid */
        .container {
            max-width: 1100px;
            margin: 2rem auto;
            padding: 0 1.5rem;
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 2rem;
            flex: 1;
            width: 100%;
            box-sizing: border-box;
        }

        .card {
            background: var(--white);
            border-radius: var(--radius-lg);
            border: 1.5px solid var(--slate-200);
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .card-title {
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--slate-400);
            margin-bottom: 1.25rem;
        }

        /* Loader */
        #loader {
            position: absolute;
            inset: 0;
            background: var(--white);
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-lg);
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--green-50);
            border-top: 3px solid var(--accent);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Video Area */
        .canvas-container {
            position: relative;
            border-radius: var(--radius-md);
            overflow: hidden;
            background: #000;
            line-height: 0;
        }

        video { width: 100%; height: auto; }
        canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

        /* Settings Area */
        .settings-area {
            margin-top: 1.5rem;
            padding: 1.25rem;
            background: var(--slate-50);
            border-radius: var(--radius-md);
            border: 1px solid var(--slate-200);
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.8125rem;
            font-weight: 700;
            color: var(--slate-700);
            margin-bottom: 8px;
        }

        input[type=range] { width: 100%; accent-color: var(--accent); cursor: pointer; }

        /* Icon Grid */
        .icon-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 1.25rem;
            margin-bottom: 1.5rem;
            min-height: 100px;
        }

        .styled-icon-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            animation: fadeIn 0.4s ease forwards;
        }

        .icon-circle {
            width: 60px;
            height: 60px;
            background: var(--green-50);
            border: 2px solid var(--accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .icon-circle svg { width: 28px; height: 28px; stroke: var(--accent); fill: none; stroke-width: 1.5; }
        .icon-label { font-size: 0.75rem; font-weight: 600; color: var(--slate-800); text-align: center; }

        /* Buttons & Details */
        .btn-restart {
            width: 100%;
            padding: 0.875rem;
            background: var(--white);
            border: 1.5px solid var(--slate-200);
            border-radius: var(--radius-sm);
            font-weight: 700;
            color: var(--slate-700);
            cursor: pointer;
            margin-bottom: 1.5rem;
            transition: 0.2s;
        }

        .btn-restart:hover { border-color: var(--accent); background: var(--green-50); color: var(--accent); }

        details { border-top: 1px solid var(--slate-100); }
        summary { padding: 1rem 0; font-size: 0.8125rem; font-weight: 700; color: var(--slate-500); cursor: pointer; list-style: none; display: flex; justify-content: space-between; }
        
        .info-text { font-size: 0.75rem; color: var(--slate-500); line-height: 1.6; margin: 0; padding-bottom: 0.5rem; }

        /* Footer Style */
        .footer {
            text-align: center;
            padding: 2rem;
            background: var(--white);
            border-top: 1px solid var(--slate-200);
            margin-top: 2rem;
        }

        .footer-quote {
            color: var(--accent);
            font-size: 0.875rem;
            font-weight: 500;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @media (max-width: 900px) { .container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <header class="header">
        <a href="https://onderconstructie.github.io/fun" class="back-link">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                <line x1="19" y1="12" x2="5" y2="12"></line>
                <polyline points="12 19 5 12 12 5"></polyline>
            </svg>
            <span>Fun</span>
        </a>

        <div class="header-content">
            <div class="logo-circle">
                <svg viewBox="0 0 32 32">
                    <rect x="6" y="10" width="20" height="14" rx="2" />
                    <path d="M12 10V8a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v2" />
                    <circle cx="16" cy="17" r="4" />
                </svg>
            </div>
            <div class="title-group">
                <h1>AI Camera</h1>
                <p class="subtitle">Real-time herkenning en lokale data-analyse</p>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="card">
            <div id="loader">
                <div class="spinner"></div>
                <p id="loaderStatus" style="font-size: 0.875rem; font-weight: 600; color: var(--slate-500);">Systemen opstarten...</p>
            </div>
            <h2 class="card-title">Live Analyse</h2>
            <div class="canvas-container">
                <video id="webcam" autoplay muted playsinline></video>
                <canvas id="overlay"></canvas>
            </div>

            <div class="settings-area">
                <div class="slider-label">
                    <span>Gevoeligheid van de AI</span>
                    <span id="threshVal">65%</span>
                </div>
                <input type="range" id="threshold" min="30" max="100" value="65">
            </div>
        </div>

        <div class="card">
            <h2 class="card-title">Gedetecteerde Objecten</h2>
            <div id="iconGrid" class="icon-grid">
                </div>
            
            <button class="btn-restart" onclick="location.reload()">Sessie herstarten</button>

            <details>
                <summary>Hoe werkt dit? <span>▼</span></summary>
                <div class="info-text">
                    <p><strong>Technologie:</strong> Deze applicatie maakt gebruik van TensorFlow.js en het COCO-SSD model om objecten direct in de browser te identificeren.</p>
                    <p style="margin-top: 8px;"><strong>Privacy:</strong> Alle berekeningen worden lokaal op dit apparaat uitgevoerd. Je videodata wordt nooit verzonden naar een externe server.</p>
                </div>
            </details>
        </div>
    </div>

    <footer class="footer">
        <span class="footer-quote">Niets is wat het lijkt.</span>
    </footer>

    <script>
        const video = document.getElementById('webcam');
        const canvas = document.getElementById('overlay');
        const ctx = canvas.getContext('2d');
        const iconGrid = document.getElementById('iconGrid');
        const loader = document.getElementById('loader');
        const loaderStatus = document.getElementById('loaderStatus');
        const threshInput = document.getElementById('threshold');
        const threshDisplay = document.getElementById('threshVal');

        let model;
        let seenObjects = new Set();
        let confidenceThreshold = 0.65;

        // Icoon Definities (Specifieke SVG's)
        const iconPaths = {
            'person': '<path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle>',
            'cell phone': '<rect x="6" y="3" width="12" height="18" rx="2"></rect><circle cx="12" cy="18" r="1"></circle>',
            'laptop': '<rect x="3" y="4" width="18" height="12" rx="2"></rect><path d="M2 18h20"></path>',
            'bottle': '<path d="M10 2h4M9 5h6v12a3 3 0 0 1-3 3 3 3 0 0 1-3-3V5z"></path>',
            'cup': '<path d="M17 8h1a4 4 0 1 1 0 8h-1"></path><path d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V8z"></path>',
            'book': '<path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>',
            'remote': '<rect x="8" y="3" width="8" height="18" rx="2"></rect><circle cx="12" cy="17" r="1"></circle><rect x="10" y="6" width="4" height="2"></rect>',
            'default': '<circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="16"></line>'
        };

        // Complete COCO-SSD Vertaallijst (80 Objecten)
        const vertaling = { 
            'person': 'Persoon', 'bicycle': 'Fiets', 'car': 'Auto', 'motorcycle': 'Motor', 'airplane': 'Vliegtuig',
            'bus': 'Bus', 'train': 'Trein', 'truck': 'Vrachtwagen', 'boat': 'Boot', 'traffic light': 'Stoplicht',
            'fire hydrant': 'Brandkraan', 'stop sign': 'Stopbord', 'parking meter': 'Parkeermeter', 'bench': 'Bankje',
            'bird': 'Vogel', 'cat': 'Kat', 'dog': 'Hond', 'horse': 'Paard', 'sheep': 'Schaap', 'cow': 'Koe',
            'elephant': 'Olifant', 'bear': 'Beer', 'zebra': 'Zebra', 'giraffe': 'Giraffe', 'backpack': 'Rugzak',
            'umbrella': 'Paraplu', 'handbag': 'Handtas', 'tie': 'Stropdas', 'suitcase': 'Koffer', 'frisbee': 'Frisbee',
            'skis': 'Ski\'s', 'snowboard': 'Snowboard', 'sports ball': 'Bal', 'kite': 'Vlieger', 'baseball bat': 'Honkbalknuppel',
            'baseball glove': 'Honkbalhandschoen', 'skateboard': 'Skateboard', 'surfboard': 'Surfplank', 'tennis racket': 'Tennisracket',
            'bottle': 'Fles', 'wine glass': 'Wijnglas', 'cup': 'Beker', 'fork': 'Vork', 'knife': 'Mes', 'spoon': 'Lepel',
            'bowl': 'Kom', 'banana': 'Banaan', 'apple': 'Appel', 'sandwich': 'Broodje', 'orange': 'Sinaasappel',
            'broccoli': 'Broccoli', 'carrot': 'Wortel', 'hot dog': 'Hotdog', 'pizza': 'Pizza', 'donut': 'Donut',
            'cake': 'Taart', 'chair': 'Stoel', 'couch': 'Bank', 'potted plant': 'Plant', 'bed': 'Bed',
            'dining table': 'Tafel', 'toilet': 'Toilet', 'tv': 'Televisie', 'laptop': 'Laptop', 'mouse': 'Muis',
            'remote': 'Afstandsbediening', 'keyboard': 'Toetsenbord', 'cell phone': 'Telefoon', 'microwave': 'Magnetron',
            'oven': 'Oven', 'toaster': 'Broodrooster', 'sink': 'Gootsteen', 'refrigerator': 'Koelkast', 'book': 'Boek',
            'clock': 'Klok', 'vase': 'Vaas', 'scissors': 'Schaar', 'teddy bear': 'Knuffelbeer', 'hair drier': 'Föhn',
            'toothbrush': 'Tandenborstel'
        };

        threshInput.oninput = (e) => {
            confidenceThreshold = e.target.value / 100;
            threshDisplay.innerText = e.target.value + '%';
        };

        async function init() {
            try {
                model = await cocoSsd.load();
                loaderStatus.innerText = "Camera activeren...";
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
                video.srcObject = stream;
                video.onloadedmetadata = () => {
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    loader.style.display = 'none';
                    loop();
                };
            } catch (err) {
                loaderStatus.innerHTML = "<span style='color:#ef4444;'>Camera niet gevonden</span>";
            }
        }

        async function loop() {
            const predictions = await model.detect(video);
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            predictions.forEach(p => {
                if (p.score > confidenceThreshold) {
                    ctx.strokeStyle = '#10b981';
                    ctx.lineWidth = 3;
                    ctx.strokeRect(...p.bbox);
                    if (!seenObjects.has(p.class)) {
                        seenObjects.add(p.class);
                        const nlLabel = vertaling[p.class] || p.class; // Fallback naar Engels indien onbekend
                        const svg = iconPaths[p.class] || iconPaths['default'];
                        const div = document.createElement('div');
                        div.className = 'styled-icon-box';
                        div.innerHTML = `<div class="icon-circle"><svg viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">${svg}</svg></div><div class="icon-label">${nlLabel}</div>`;
                        iconGrid.appendChild(div);
                    }
                }
            });
            requestAnimationFrame(loop);
        }
        init();
    </script>
</body>
</html>